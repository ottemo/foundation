language: go
go:
    - 1.3
env:
    global:
        - SLACK_ORG=Ottemo PROJECT=Foundation
        - secure: IgdstVqJgSEKc/DjAhAiySFT43+GFxnm5Vejtb2fToZtMO+D1CFxn3tmFk3DOlHqBlBQPm6ADgW9lUbg/x1G7Kn2RyfMvbV2AkzRJzqfaHc5lXfUw+d5dniVyqcet/nC3Lul5C2fEsuHLsB1dTKunzGXJowHMTU/ZG4BdcgA9zM6h7XuGWO6euJylDpNfZ9nz9V9r14Wbxx2ndeaXgVtWXNpSdu85R1DaAKRzmuObtYmsnoKS5F6mL+v6UuM2A/4q08DRtD52jZwavrVOksAZynmLgjm2/wB2Ew6lZgPlRfCGdzRzCgIP5RenJd7jfrW2Q9tNrOGPpP8BEGjjBg7KQ==

before_install:
    - wget -q -O ~/go.tgz https://storage.googleapis.com/golang/go1.5.1.linux-amd64.tar.gz
    - tar -C $HOME -xzf ~/go.tgz
    - export GOROOT=$HOME/go
    - export GOPATH=$HOME/workspace
    - export PATH=$SHIPPABLE_GOPATH/bin:$HOME/go/bin:$PATH

install: 
    - cd $GOPATH/src/github.com/ottemo/foundation

script: 
    - go version

# only build develop
branch:
    only:
        - develop

after_failure:
    - python bin/slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN

after_success:
    - REMOTE_HOST=rk.dev.ottemo.io bash bin/deploy.sh
    - REMOTE_HOST=kg.dev.ottemo.io bash bin/deploy.sh
    - REMOTE_HOST=godoc.ottemo.io bash bin/update-docs.sh
    - REMOTE_HOST=ub.staging.ottemo.io bash bin/deploy.sh
    - python bin/slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN -s

notifications:
    email: false
