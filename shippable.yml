language: go
go:
    - 1.3
env:
    global:
        - SLACK_ORG=Ottemo PROJECT=Foundation
        - secure: T2ImzTpns/H12TPzWD+/XYWBJzvLdIdBj2rzO7EgCezxBRk3EcixCCcj6ImXKxk7kyCMHJR/fALjoE7u7elHG9Y+TmtR7useu95TMVekO66RD702jrEu4LA7tUGvDfBzTw8Dr4PVeCjr0NFQlJ/z1XHk9knrsHEXydHRtQ4ciN/DTw4M1yVImp3VXYMpOePCGIfjcYA20M8/ZvTZA9Nv5f/eBcGZbPLsNCdvMasUEekWwpZzJvXycX7tS7EYc5kUZdqzpHpToY1/HYLtcLm4qmILUahWiaMKAYloA0nT/FCUcPpZLCOf0hhm9nNaEuE1YfA/3anAhBu89rqqSPzM5Q==

before_install:
    - wget -q -O ~/go.tgz https://storage.googleapis.com/golang/go1.5.1.linux-amd64.tar.gz
    - tar -C $HOME -xzf ~/go.tgz
    - export GOROOT=$HOME/go
    - export GOPATH=$HOME/workspace
    - export PATH=$SHIPPABLE_GOPATH/bin:$HOME/go/bin:$PATH

install: 
    - cd $GOPATH/src/github.com/ottemo/foundation

script: 
    - go version

# only build develop
branch:
    only:
        - develop

after_failure:
    - python bin/slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN

after_success:
    - REMOTE_HOST=rk.staging.ottemo.io bash bin/deploy.sh
    - REMOTE_HOST=kg.staging.ottemo.io bash bin/deploy.sh
    - REMOTE_HOST=godoc.ottemo.io bash bin/update-docs.sh
    - REMOTE_HOST=ub.staging.ottemo.io bash bin/deploy.sh
    - REMOTE_HOST=dev.ottemo.io bash bin/deploy.sh
    - python bin/slack_notifier.py --org $SLACK_ORG --project $PROJECT --token $SLACK_TOKEN -s

notifications:
    email: false
