box: wercker/golang
# Build definition
build:
    # The steps that will be executed on build
    steps:
        # Sets the go workspace and places you package
        # at the right place in the workspace tree
        - setup-go-workspace

          # Gets the dependencies
        - script:
            name: go get
            code: |
                cd $WERCKER_SOURCE_DIR
                go version
                go get -t ./...

                # Build the project
        - script:
            name: go build
            code: |
                go build -tags mongo ./...

                # Test the project
        - script:
            name: go test
            code: |
                go test ./...
    after-steps:
        - wercker/hipchat-notify@1.0.3:
            token: $HIPCHAT_TOKEN
            room-id: 394852
            from-name: Wercker
deploy:
    steps:
        - wercker/add-ssh-key:
            keyname: REMOTE_HOST_KEY
        - add-to-known_hosts:
            hostname: $REMOTE_HOST
        - script:
            name: Copy fig.yml
            code: scp fig.yml root@$REMOTE_HOST:/tmp/foundation/fig.yml
        - script:
            name: Fig Up -d
            code: ssh root@$REMOTE_HOST "cd /tmp/foundation; fig kill; fig up -d"
    after-steps:
        - wercker/hipchat-notify@1.0.3:
            token: $HIPCHAT_TOKEN
            room-id: 394852
            from-name: Wercker
